<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>agexplorer</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <main class="card" role="main">
    <h1>Agexplorer</h1>
    <p class="lead">Enter when you were born.</p>

    <div class="row">
      <div class="col">
        <label for="dob">Date of birth</label>
        <input id="dob" type="date" aria-label="date of birth" />
      </div>
      <div class="col">
      </div>
    </div>

    <div class="controls">
      <button id="calc">Calculate</button>
      <button id="live" class="secondary">Start live clock</button>
    </div>

    <div id="output" class="result" aria-live="polite">
      <div class="tile"><div class="n" id="years">—</div><div class="label">Years </div></div>
      <div class="tile"><div class="n" id="months">—</div><div class="label">Months </div></div>
      <div class="tile"><div class="n" id="weeks">—</div><div class="label">Weeks</div></div>
      <div class="tile"><div class="n" id="days">—</div><div class="label">Days </div></div>
      <div class="tile"><div class="n" id="hours">—</div><div class="label">Hours </div></div>
      <div class="tile"><div class="n" id="minutes">—</div><div class="label">Minutes</div></div>
      <div class="tile"><div class="n" id="seconds">—</div><div class="label">Seconds </div></div>
    </div>

  </main>

<script>
(function(){
  const dobInput = document.getElementById('dob');
  const calcBtn = document.getElementById('calc');
  const liveBtn = document.getElementById('live');
  const output = document.getElementById('output');

  const ids = ['years','months','weeks','days','hours','minutes','seconds']
    .reduce((o,id)=>{ o[id]=document.getElementById(id); return o }, {});

  let liveInterval = null;


  function format(n){
    if (typeof n === 'number' && !isNaN(n)) return n.toLocaleString();
    return String(n);
  }

  function calcFromBirth(birth){
    const now = new Date();
    if (!(birth instanceof Date) || isNaN(birth)) return null;
    if (birth > now) return null;

    const totalMs = now - birth;
    const totalSeconds = Math.floor(totalMs / 1000);
    const totalMinutes = Math.floor(totalSeconds / 60);
    const totalHours = Math.floor(totalMinutes / 60);
    const totalDays = Math.floor(totalHours / 24);
    const totalWeeks = Math.floor(totalDays / 7);


    let years = now.getFullYear() - birth.getFullYear();
    let months = now.getMonth() - birth.getMonth();
    let days = now.getDate() - birth.getDate();

    if (days < 0) {

      const prevMonth = new Date(now.getFullYear(), now.getMonth(), 0);
      days += prevMonth.getDate();
      months -= 1;
    }
    if (months < 0) {
      months += 12;
      years -= 1;
    }

    return {
      years, months, days,
      totalWeeks, totalDays, totalHours, totalMinutes, totalSeconds,
    };
  }

 function showResult(obj){
    if (!obj){
      alert('Please enter a valid past date of birth.');
      return;
    }
    output.style.display = 'grid';

    ids.years.textContent = format(obj.years);

    const totalMonths = obj.years * 12 + obj.months;
    ids.months.textContent = format(totalMonths);

    ids.weeks.textContent = format(obj.totalWeeks);
    ids.days.textContent = format(obj.totalDays);
    ids.hours.textContent = format(obj.totalHours);
    ids.minutes.textContent = format(obj.totalMinutes);
    ids.seconds.textContent = format(obj.totalSeconds);
  }

  function compute(){
    const dobVal = dobInput.value;
    if (!dobVal){
      alert('Please enter your date of birth.');
      return;
    }

    const birth = new Date(dobVal + 'T00:00:00');
    const res = calcFromBirth(birth);
    if (!res){
      alert('Please enter a valid past date.');
      return;
    }
    showResult(res);
  }

  calcBtn.addEventListener('click', compute);

  liveBtn.addEventListener('click', ()=>{
    if (liveInterval){
      clearInterval(liveInterval);
      liveInterval = null;
      liveBtn.textContent = 'Start live clock';
      return;
    }
    if (!dobInput.value){
      alert('Please enter your date of birth to start live clock.');
      return;
    }
    compute(); 
    liveInterval = setInterval(compute, 1000);
    liveBtn.textContent = 'Stop live clock';
  });

  dobInput.addEventListener('keydown', (e)=>{ if (e.key === 'Enter') compute(); });

})();
</script>
</body>
</html>
